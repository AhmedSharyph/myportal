<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Redirect if already logged in
    const email = localStorage.getItem("userEmail");
    if (email) {
      window.location.replace("dashboard.html");
    }

    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzdSJ_2mNS8XODvPlGJFPICHYUIA8qc26PodQ1f7Z0oWbOF430LMLo_3vIeMIK66UGzuw/exec";

    async function loginUser(e) {
      e.preventDefault();
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;

      const formData = new URLSearchParams({
        action: "login",
        email: email,
        password: password
      });

      try {
        const res = await fetch(WEB_APP_URL, { method: "POST", body: formData });
        const result = await res.json();

        if (result.success) {
          localStorage.setItem("userEmail", email);
          localStorage.setItem("isAdmin", result.isAdmin || "No");
          window.location.href = "dashboard.html";
        } else {
          alert(result.message);
        }
      } catch (err) {
        console.error(err);
        alert("Error connecting to server. Please try again later.");
      }
    }
  </script>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

  <div class="bg-white p-8 rounded shadow-md w-80">
    <h2 class="text-xl font-bold mb-4 text-center">Login</h2>
    <form onsubmit="loginUser(event)">
      <input type="email" id="email" placeholder="Email" required class="w-full p-2 mb-3 border rounded">
      <input type="password" id="password" placeholder="Password" required class="w-full p-2 mb-3 border rounded">
      <button type="submit" class="w-full bg-blue-600 text-white p-2 rounded hover:bg-blue-700">Login</button>
    </form>
    <p class="mt-4 text-sm text-gray-600 text-center">
      Contact administrator for registration.
    </p>
  </div>

</body>
</html>
